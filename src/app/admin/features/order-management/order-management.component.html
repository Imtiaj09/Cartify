<div class="container-fluid">
  <!-- Top Action Bar -->
  <div class="d-flex justify-content-end flex-wrap mb-4">
    <button class="btn btn-success me-2" type="button" (click)="openAddOrderModal()">
      <i class="bi bi-plus-circle me-1"></i> Add Order
    </button>
    <button class="btn btn-outline-secondary">
      <i class="bi bi-three-dots-vertical"></i> More Action
    </button>
  </div>

  <!-- Summary Cards -->
  <div class="row g-4 mb-4">
    <div class="col-lg-3 col-md-6">
      <div class="card summary-card bg-primary-soft">
        <div class="card-body d-flex align-items-center">
          <div class="icon-circle bg-primary text-white">
            <i class="bi bi-cart-check"></i>
          </div>
          <div class="ms-3">
            <h5 class="card-title">Total Order</h5>
            <p class="card-text fw-bold fs-4">10.7K</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-6">
      <div class="card summary-card bg-warning-soft">
        <div class="card-body d-flex align-items-center">
          <div class="icon-circle bg-warning text-white">
            <i class="bi bi-clock-history"></i>
          </div>
          <div class="ms-3">
            <h5 class="card-title">New Order</h5>
            <p class="card-text fw-bold fs-4">509</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-6">
      <div class="card summary-card bg-success-soft">
        <div class="card-body d-flex align-items-center">
          <div class="icon-circle bg-success text-white">
            <i class="bi bi-check-circle"></i>
          </div>
          <div class="ms-3">
            <h5 class="card-title">Complete Order</h5>
            <p class="card-text fw-bold fs-4">8.9K</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-6">
      <div class="card summary-card bg-danger-soft">
        <div class="card-body d-flex align-items-center">
          <div class="icon-circle bg-danger text-white">
            <i class="bi bi-x-circle"></i>
          </div>
          <div class="ms-3">
            <h5 class="card-title">Canceled Order</h5>
            <p class="card-text fw-bold fs-4">94</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Table Controls & Filters -->
  <div class="card border-light-subtle shadow-sm">
    <div class="card-body">
      <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-secondary active">All Order</button>
          <button type="button" class="btn btn-outline-secondary">Completed</button>
          <button type="button" class="btn btn-outline-secondary">Pending</button>
          <button type="button" class="btn btn-outline-secondary">Canceled</button>
        </div>
        <div class="d-flex flex-wrap align-items-center gap-2 mt-2 mt-md-0">
          <div class="input-group">
            <span class="input-group-text bg-transparent"><i class="bi bi-search"></i></span>
            <input type="text" class="form-control border-start-0" placeholder="Search Order report...">
          </div>
          <button type="button"
            class="btn btn-outline-secondary square-btn"
            [disabled]="selectedOrderIds.size !== 1"
            (click)="editSelectedOrder()">
            <i class="bi bi-pencil"></i>
          </button>
          <button type="button"
            class="btn btn-outline-secondary square-btn"
            [disabled]="selectedOrderIds.size === 0"
            (click)="deleteSelectedOrders()">
            <i class="bi bi-trash"></i>
          </button>
          <button type="button"
            class="btn btn-outline-secondary square-btn"
            [disabled]="selectedOrderIds.size !== 1"
            (click)="viewReport()"
            aria-label="View cash memo report">
            <i class="bi bi-file-text"></i>
          </button>
          <button type="button"
            class="btn btn-outline-secondary square-btn"
            [disabled]="selectedOrderIds.size !== 1 || isReportDownloading"
            (click)="downloadOrder()"
            [attr.aria-label]="isReportDownloading ? 'Generating PDF' : 'Download cash memo PDF'">
            <span *ngIf="isReportDownloading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            <i *ngIf="!isReportDownloading" class="bi bi-download"></i>
          </button>
          <button type="button"
            class="btn btn-outline-secondary square-btn"
            [disabled]="selectedOrderIds.size !== 1"
            (click)="printOrder()"
            aria-label="Print cash memo">
            <i class="bi bi-printer"></i>
          </button>
        </div>
      </div>

      <!-- Order Table -->
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th scope="col" class="text-center" style="width: 44px;">
                <input type="checkbox"
                  class="form-check-input"
                  [checked]="areAllVisibleOrdersSelected()"
                  [indeterminate]="hasPartialSelection()"
                  (change)="toggleAllSelection()"
                  aria-label="Select all orders">
              </th>
              <th scope="col">NO.</th>
              <th scope="col">Order Id</th>
              <th scope="col">Product</th>
              <th scope="col">Date</th>
              <th scope="col">Price</th>
              <th scope="col">Payment</th>
              <th scope="col">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of getPaginatedOrders(); let i = index">
              <td class="text-center">
                <input type="checkbox"
                  class="form-check-input"
                  [checked]="isSelected(order.id)"
                  (change)="toggleSelection(order.id)"
                  [attr.aria-label]="'Select order #' + order.id">
              </td>
              <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
              <td class="fw-bold">#{{ order.id }}</td>
              <td>
                <div class="d-flex align-items-center">
                  <img [src]="order.productImage" class="product-img me-2" alt="Product">
                  <span>{{ order.productName }}</span>
                </div>
              </td>
              <td>{{ order.date }}</td>
              <td>${{ order.price.toFixed(2) }}</td>
              <td>
                <div class="d-flex align-items-center">
                  <i class="bi bi-credit-card-2-front me-2 fs-5"></i>
                  <span>{{ order.paymentMethod }}</span>
                </div>
              </td>
              <td>
                <div class="dropdown status-dropdown" [class.show]="isStatusMenuOpen(order.id)">
                  <button class="btn btn-sm dropdown-toggle status-btn" type="button"
                    (click)="toggleStatusMenu(order.id, $event)"
                    [attr.aria-expanded]="isStatusMenuOpen(order.id)"
                    [ngClass]="{
                      'btn-outline-success': order.status === 'Delivered',
                      'btn-outline-warning': order.status === 'Pending',
                      'btn-outline-info': order.status === 'Shipped',
                      'btn-outline-danger': order.status === 'Cancelled'
                    }">
                    {{ order.status }}
                  </button>
                  <ul class="dropdown-menu" [class.show]="isStatusMenuOpen(order.id)" (click)="$event.stopPropagation()">
                    <li>
                      <button type="button" class="dropdown-item text-success" (click)="updateStatus(order, 'Delivered')">
                        <i class="bi bi-check-circle me-2"></i>Delivered
                      </button>
                    </li>
                    <li>
                      <button type="button" class="dropdown-item text-warning" (click)="updateStatus(order, 'Pending')">
                        <i class="bi bi-clock me-2"></i>Pending
                      </button>
                    </li>
                    <li>
                      <button type="button" class="dropdown-item text-info" (click)="updateStatus(order, 'Shipped')">
                        <i class="bi bi-truck me-2"></i>Shipped
                      </button>
                    </li>
                    <li>
                      <button type="button" class="dropdown-item text-danger" (click)="updateStatus(order, 'Cancelled')">
                        <i class="bi bi-x-circle me-2"></i>Cancelled
                      </button>
                    </li>
                  </ul>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination Controls -->
      <div class="d-flex justify-content-center mt-4">
        <nav aria-label="Order pagination">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button class="page-link" (click)="prevPage()" aria-label="Previous">
                <span aria-hidden="true">&laquo; Previous</span>
              </button>
            </li>

            <li class="page-item" *ngFor="let page of paginationPages"
                [class.active]="page === currentPage"
                [class.disabled]="page === '...'">
              <button class="page-link"
                      (click)="page !== '...' && goToPage(page)">
                {{ page }}
              </button>
            </li>

            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button class="page-link" (click)="nextPage()" aria-label="Next">
                <span aria-hidden="true">Next &raquo;</span>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>

  <!-- Digital Cash Memo Modal -->
  <div class="modal fade"
    tabindex="-1"
    [class.show]="isReportModalOpen"
    [style.display]="isReportModalOpen ? 'block' : 'none'"
    [attr.aria-hidden]="!isReportModalOpen"
    aria-labelledby="cashMemoModalLabel"
    (click)="closeReportModal()">
    <div class="modal-dialog modal-xl modal-dialog-scrollable cash-memo-modal" (click)="$event.stopPropagation()">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header">
          <div>
            <h5 class="modal-title fw-semibold" id="cashMemoModalLabel">Digital Cash Memo</h5>
            <small class="text-muted">Invoice snapshot for the selected order</small>
          </div>
          <button type="button" class="btn-close" aria-label="Close" (click)="closeReportModal()"></button>
        </div>

        <div class="modal-body cash-memo-modal-body">
          <ng-container *ngIf="reportData as report; else noReportSelected">
            <div class="cash-memo-print-area" id="cashMemoPrintable">
              <article class="cash-memo-sheet">
                <header class="cash-memo-header">
                  <div>
                    <p class="cash-memo-brand mb-1">Cartify</p>
                    <h4 class="mb-1">Digital Cash Memo</h4>
                    <small class="text-muted">Professional order invoice report</small>
                  </div>
                  <div class="text-end">
                    <div class="memo-status-chip"
                      [ngClass]="{
                        'status-delivered': report.order.status === 'Delivered',
                        'status-pending': report.order.status === 'Pending',
                        'status-shipped': report.order.status === 'Shipped',
                        'status-cancelled': report.order.status === 'Cancelled'
                      }">
                      {{ report.order.status }}
                    </div>
                    <p class="mb-0 mt-2 small text-muted">Order ID: <span class="fw-semibold text-dark">#{{ report.order.id }}</span></p>
                    <p class="mb-0 small text-muted">Order Date: <span class="fw-semibold text-dark">{{ report.order.date }}</span></p>
                  </div>
                </header>

                <section class="cash-memo-grid">
                  <div class="cash-memo-block">
                    <h6>Customer & Contact</h6>
                    <p><span>Customer:</span> {{ report.customerName }}</p>
                    <p><span>Email:</span> {{ report.email }}</p>
                    <p><span>Phone:</span> {{ report.phone }}</p>
                  </div>
                  <div class="cash-memo-block">
                    <h6>Addresses</h6>
                    <p><span>Shipping:</span> {{ report.shippingAddress }}</p>
                    <p><span>Billing:</span> {{ report.billingAddress }}</p>
                  </div>
                </section>

                <section class="cash-memo-section">
                  <h6 class="cash-memo-section-title">Order Details</h6>
                  <div class="table-responsive">
                    <table class="table table-sm align-middle memo-items-table mb-0">
                      <thead>
                        <tr>
                          <th scope="col">Product</th>
                          <th scope="col" class="text-center">Quantity</th>
                          <th scope="col" class="text-end">Unit Price</th>
                          <th scope="col" class="text-end">Row Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of report.items">
                          <td>{{ item.productName }}</td>
                          <td class="text-center">{{ item.quantity }}</td>
                          <td class="text-end">${{ item.unitPrice | number:'1.2-2' }}</td>
                          <td class="text-end fw-semibold">${{ item.rowTotal | number:'1.2-2' }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </section>

                <section class="cash-memo-totals">
                  <h6 class="cash-memo-section-title">Payment & Totals</h6>
                  <div class="memo-total-row">
                    <span>Subtotal</span>
                    <span>${{ report.subtotal | number:'1.2-2' }}</span>
                  </div>
                  <div class="memo-total-row">
                    <span>Discount</span>
                    <span>- ${{ report.discount | number:'1.2-2' }}</span>
                  </div>
                  <div class="memo-total-row">
                    <span>Shipping</span>
                    <span>${{ report.shipping | number:'1.2-2' }}</span>
                  </div>
                  <div class="memo-total-row">
                    <span>Tax</span>
                    <span>${{ report.tax | number:'1.2-2' }}</span>
                  </div>
                  <div class="memo-total-row grand-total">
                    <span>Final Total</span>
                    <span>${{ report.finalTotal | number:'1.2-2' }}</span>
                  </div>
                </section>

                <section class="cash-memo-grid metadata-grid">
                  <div class="cash-memo-block">
                    <h6>Metadata</h6>
                    <p><span>Market:</span> {{ report.market }}</p>
                    <p><span>Tags:</span> {{ report.tags }}</p>
                    <p><span>Payment Terms:</span> {{ report.paymentTerms }}</p>
                  </div>
                  <div class="cash-memo-block">
                    <h6>Notes</h6>
                    <p class="memo-notes">{{ report.notes }}</p>
                  </div>
                </section>
              </article>
            </div>
          </ng-container>
          <ng-template #noReportSelected>
            <div class="alert alert-light border text-muted mb-0">
              Select exactly one order and click Report to generate the cash memo.
            </div>
          </ng-template>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" (click)="closeReportModal()">Close</button>
          <button type="button"
            class="btn btn-outline-primary"
            [disabled]="selectedOrderIds.size !== 1"
            (click)="printOrder()">
            <i class="bi bi-printer me-1"></i> Print
          </button>
          <button type="button"
            class="btn btn-success"
            [disabled]="selectedOrderIds.size !== 1 || isReportDownloading"
            (click)="downloadOrder()">
            <span *ngIf="isReportDownloading" class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
            <i *ngIf="!isReportDownloading" class="bi bi-download me-1"></i>
            {{ isReportDownloading ? 'Generating PDF...' : 'Download PDF' }}
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop fade show" *ngIf="isReportModalOpen"></div>

  <!-- Manual Order Modal -->
  <div class="modal fade"
    tabindex="-1"
    [class.show]="isAddOrderModalOpen"
    [style.display]="isAddOrderModalOpen ? 'block' : 'none'"
    [attr.aria-hidden]="!isAddOrderModalOpen"
    aria-labelledby="manualOrderModalLabel"
    (click)="closeAddOrderModal()">
    <div class="modal-dialog modal-xl modal-dialog-scrollable manual-order-modal" (click)="$event.stopPropagation()">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header">
          <div>
            <h5 class="modal-title fw-semibold" id="manualOrderModalLabel">{{ isEditMode ? 'Edit Order' : 'Manual Order' }}</h5>
            <small class="text-muted">{{ isEditMode ? 'Update the selected order from the dashboard' : 'Create and manage custom orders from the dashboard' }}</small>
          </div>
          <button type="button" class="btn-close" aria-label="Close" (click)="closeAddOrderModal()"></button>
        </div>

        <div class="modal-body p-0">
          <div class="row g-0 flex-column flex-lg-row">
            <!-- Left: Product & Payment Details -->
            <div class="col-lg-8 p-4 manual-order-left">
              <div class="mb-3">
                <label class="form-label small text-muted">Order ID</label>
                <input type="number" class="form-control form-control-sm" [(ngModel)]="newOrderId">
              </div>
              <div class="manual-section mb-4">
                <h6 class="section-title">Product</h6>
                <div class="input-group mb-3">
                  <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                  <input type="text" class="form-control" placeholder="Search Product" [(ngModel)]="searchProductQuery">
                  <button class="btn btn-outline-secondary" type="button">Browse</button>
                </div>
                <div class="table-responsive border rounded-3">
                  <table class="table align-middle mb-0 manual-product-table">
                    <thead>
                      <tr>
                        <th scope="col">Product</th>
                        <th scope="col" class="text-center">Quantity</th>
                        <th scope="col" class="text-end">Total</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let product of manualProducts">
                        <td>
                          <div class="d-flex align-items-center">
                            <img [src]="product.image" class="product-img me-2" alt="Product">
                            <div>
                              <div class="fw-semibold">{{ product.name }}</div>
                              <small class="text-muted">SKU: {{ product.sku }}</small>
                            </div>
                          </div>
                        </td>
                        <td class="text-center">
                          <input type="number"
                            class="form-control form-control-sm quantity-input mx-auto"
                            min="1"
                            [(ngModel)]="product.quantity"
                            (ngModelChange)="onProductQuantityChange()">
                        </td>
                        <td class="text-end fw-semibold">${{ getProductRowTotal(product).toFixed(2) }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="manual-section mb-4">
                <h6 class="section-title">Payment & Totals</h6>
                <div class="totals-list border rounded-3">
                  <div class="totals-row">
                    <span>Subtotal</span>
                    <div class="price-input-wrap">
                      <span class="price-symbol">$</span>
                      <input type="number"
                        class="form-control form-control-sm erp-input price-input text-end"
                        min="0"
                        step="0.01"
                        [(ngModel)]="subtotal"
                        (ngModelChange)="onSubtotalInputChange()">
                    </div>
                  </div>
                  <div class="totals-row">
                    <div class="d-flex align-items-center flex-wrap gap-2">
                      <span>Edit Discount</span>
                      <button type="button"
                        class="btn btn-sm rounded-pill px-3"
                        [ngClass]="isNewCustomer ? 'btn-success' : 'btn-outline-secondary'"
                        (click)="isNewCustomer = !isNewCustomer">
                        New Customer
                      </button>
                    </div>
                    <div class="price-input-wrap">
                      <span class="price-symbol">- $</span>
                      <input type="number"
                        class="form-control form-control-sm erp-input price-input text-end"
                        min="0"
                        step="0.01"
                        [(ngModel)]="discount"
                        (ngModelChange)="onPricingFieldChange()">
                    </div>
                  </div>
                  <div class="totals-row">
                    <div>
                      <span>Edit Shipping/Delivery</span>
                      <small class="d-block text-muted">Free shipping</small>
                    </div>
                    <div class="price-input-wrap">
                      <span class="price-symbol">$</span>
                      <input type="number"
                        class="form-control form-control-sm erp-input price-input text-end"
                        min="0"
                        step="0.01"
                        [(ngModel)]="shipping"
                        (ngModelChange)="onPricingFieldChange()">
                    </div>
                  </div>
                  <div class="totals-row">
                    <div>
                      <span>Tax Rate (%)</span>
                      <small class="d-block text-muted">Applied on (Subtotal - Discount)</small>
                    </div>
                    <div class="price-input-wrap">
                      <input type="number"
                        class="form-control form-control-sm erp-input price-input text-end"
                        min="0"
                        step="0.01"
                        [(ngModel)]="taxRate"
                        (ngModelChange)="onTaxRateChange()">
                      <span class="price-symbol">%</span>
                      <small class="text-muted ms-1">= ${{ estimatedTaxAmount.toFixed(2) }}</small>
                    </div>
                  </div>
                  <div class="totals-row">
                    <div>
                      <span>Estimated Tax</span>
                      <small class="d-block text-muted">Customer exempt</small>
                    </div>
                    <div class="price-input-wrap">
                      <span class="price-symbol">$</span>
                      <input type="number"
                        class="form-control form-control-sm erp-input price-input text-end"
                        readonly
                        step="0.01"
                        [ngModel]="estimatedTaxAmount">
                    </div>
                  </div>
                  <div class="totals-row fw-semibold">
                    <span>Final Total</span>
                    <span class="text-success">${{ finalTotal.toFixed(2) }}</span>
                  </div>
                </div>
              </div>

              <div class="manual-section">
                <div class="section-title d-flex align-items-center">
                  <i class="bi bi-clock-history me-2 text-success"></i>
                  <span>Payment Due Later</span>
                </div>
                <label class="form-label text-muted small mb-2">Payment Terms</label>
                <div class="dropdown payment-terms-dropdown" [class.show]="isPaymentTermsMenuOpen">
                  <button type="button"
                    class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-between"
                    [attr.aria-expanded]="isPaymentTermsMenuOpen"
                    (click)="togglePaymentTermsMenu($event)">
                    <span>{{ selectedPaymentTerm }}</span>
                    <i class="bi bi-chevron-down"></i>
                  </button>
                  <ul class="dropdown-menu w-100" [class.show]="isPaymentTermsMenuOpen" (click)="$event.stopPropagation()">
                    <li *ngFor="let term of paymentTerms">
                      <button type="button" class="dropdown-item" (click)="selectPaymentTerm(term)">{{ term }}</button>
                    </li>
                  </ul>
                </div>
                <textarea class="form-control form-control-sm mt-3 erp-input"
                  rows="3"
                  [(ngModel)]="paymentHelperNote"
                  placeholder="Helper note for payment schedule, reminders, or customer instructions..."></textarea>
              </div>
            </div>

            <!-- Right: Order Metadata -->
            <div class="col-lg-4 p-4 manual-order-right">
              <div class="meta-card mb-3">
                <div class="meta-card-header">
                  <h6 class="mb-0">Notes</h6>
                  <button type="button" class="btn btn-link p-0 text-muted edit-btn" (click)="toggleMetadataEdit('notes', $event)">
                    <i class="bi" [ngClass]="isEditingMetadata.notes ? 'bi-check2' : 'bi-pencil'"></i>
                  </button>
                </div>
                <ng-container *ngIf="isEditingMetadata.notes; else notesView">
                  <textarea class="form-control form-control-sm mt-2 erp-input"
                    rows="3"
                    [(ngModel)]="notes"
                    placeholder="Internal order notes..."></textarea>
                </ng-container>
                <ng-template #notesView>
                  <p class="mb-0 text-muted mt-2">{{ notes || 'No internal notes' }}</p>
                </ng-template>
              </div>

              <div class="meta-card mb-3">
                <div class="meta-card-header">
                  <h6 class="mb-0">Customer</h6>
                  <button type="button" class="btn btn-link p-0 text-muted edit-btn" (click)="toggleMetadataEdit('customer', $event)">
                    <i class="bi" [ngClass]="isEditingMetadata.customer ? 'bi-check2' : 'bi-pencil'"></i>
                  </button>
                </div>
                <ng-container *ngIf="isEditingMetadata.customer; else customerView">
                  <input type="text"
                    class="form-control form-control-sm mt-2 erp-input"
                    [(ngModel)]="customerName"
                    placeholder="Search or add a customer">
                  <input type="text"
                    class="form-control form-control-sm mt-2 erp-input"
                    [(ngModel)]="customerId"
                    placeholder="Customer ID">
                </ng-container>
                <ng-template #customerView>
                  <p class="mb-1 fw-semibold mt-2">{{ customerName || 'No customer selected' }}</p>
                  <small class="text-muted">{{ customerId || 'Customer ID not assigned' }}</small>
                </ng-template>
              </div>

              <div class="meta-card mb-3">
                <div class="meta-card-header">
                  <h6 class="mb-0">Order Date</h6>
                </div>
                <input type="date" class="form-control form-control-sm mt-2 erp-input" [(ngModel)]="orderDate">
              </div>

              <div class="meta-card mb-3">
                <div class="meta-card-header">
                  <h6 class="mb-0">Contact Information</h6>
                  <button type="button" class="btn btn-link p-0 text-muted edit-btn" (click)="toggleMetadataEdit('contact', $event)">
                    <i class="bi" [ngClass]="isEditingMetadata.contact ? 'bi-check2' : 'bi-pencil'"></i>
                  </button>
                </div>
                <ng-container *ngIf="isEditingMetadata.contact; else contactView">
                  <input type="email"
                    class="form-control form-control-sm mt-2 erp-input"
                    [(ngModel)]="contactEmail"
                    placeholder="Email">
                  <input type="tel"
                    class="form-control form-control-sm mt-2 erp-input"
                    [(ngModel)]="contactPhone"
                    placeholder="Phone">
                </ng-container>
                <ng-template #contactView>
                  <p class="mb-1 mt-2">{{ contactEmail || 'No email added' }}</p>
                  <small class="text-muted">{{ contactPhone || 'No phone added' }}</small>
                </ng-template>
              </div>

              <div class="meta-card mb-3">
                <div class="meta-card-header">
                  <h6 class="mb-0">Shipping Address</h6>
                  <button type="button" class="btn btn-link p-0 text-muted edit-btn" (click)="toggleMetadataEdit('shipping', $event)">
                    <i class="bi" [ngClass]="isEditingMetadata.shipping ? 'bi-check2' : 'bi-pencil'"></i>
                  </button>
                </div>
                <ng-container *ngIf="isEditingMetadata.shipping; else shippingView">
                  <textarea class="form-control form-control-sm mt-2 erp-input"
                    rows="3"
                    [(ngModel)]="shippingAddress"
                    placeholder="Street, City, State, Zip Code"></textarea>
                </ng-container>
                <ng-template #shippingView>
                  <p class="mb-0 text-muted mt-2">{{ shippingAddress || 'No shipping address added' }}</p>
                </ng-template>
              </div>

              <div class="meta-card mb-3">
                <div class="meta-card-header">
                  <h6 class="mb-0">Billing Address</h6>
                  <button type="button" class="btn btn-link p-0 text-muted edit-btn" (click)="toggleMetadataEdit('billing', $event)">
                    <i class="bi" [ngClass]="isEditingMetadata.billing ? 'bi-check2' : 'bi-pencil'"></i>
                  </button>
                </div>
                <ng-container *ngIf="isEditingMetadata.billing; else billingView">
                  <textarea class="form-control form-control-sm mt-2 erp-input"
                    rows="3"
                    [(ngModel)]="billingAddress"
                    placeholder="Billing address"></textarea>
                </ng-container>
                <ng-template #billingView>
                  <p class="mb-0 text-muted mt-2">{{ billingAddress || 'No billing address added' }}</p>
                </ng-template>
              </div>

              <div class="meta-card mb-3">
                <div class="meta-card-header">
                  <h6 class="mb-0">Market</h6>
                  <button type="button" class="btn btn-link p-0 text-muted edit-btn" (click)="toggleMetadataEdit('market', $event)">
                    <i class="bi" [ngClass]="isEditingMetadata.market ? 'bi-check2' : 'bi-pencil'"></i>
                  </button>
                </div>
                <ng-container *ngIf="isEditingMetadata.market; else marketView">
                  <select class="form-select form-select-sm mt-2 erp-input" [(ngModel)]="market">
                    <option>Website Store</option>
                    <option>Facebook Shop</option>
                    <option>WhatsApp Commerce</option>
                    <option>Walk-in</option>
                  </select>
                </ng-container>
                <ng-template #marketView>
                  <p class="mb-0 text-muted mt-2">{{ market || 'No market selected' }}</p>
                </ng-template>
              </div>

              <div class="meta-card">
                <div class="meta-card-header">
                  <h6 class="mb-0">Tags</h6>
                  <button type="button" class="btn btn-link p-0 text-muted edit-btn" (click)="toggleMetadataEdit('tags', $event)">
                    <i class="bi" [ngClass]="isEditingMetadata.tags ? 'bi-check2' : 'bi-pencil'"></i>
                  </button>
                </div>
                <ng-container *ngIf="isEditingMetadata.tags; else tagsView">
                  <input type="text"
                    class="form-control form-control-sm mt-2 erp-input"
                    [(ngModel)]="tags"
                    placeholder="Priority, VIP, COD">
                </ng-container>
                <ng-template #tagsView>
                  <p class="mb-0 text-muted mt-2">{{ tags || 'No tags added' }}</p>
                </ng-template>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" (click)="closeAddOrderModal()">Cancel</button>
          <button type="button" class="btn btn-success px-4" (click)="createOrder()">{{ isEditMode ? 'Update Order' : 'Create Order' }}</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop fade show" *ngIf="isAddOrderModalOpen"></div>
</div>
