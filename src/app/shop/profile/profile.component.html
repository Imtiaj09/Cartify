<div class="container py-5">
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="fw-bold">My Account</h2>
      <p class="text-muted">Manage your orders and personal details</p>
    </div>
  </div>

  <div class="row">
    <!-- Left Sidebar -->
    <div class="col-lg-3 mb-4 mb-lg-0">
      <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="list-group list-group-flush">
          <button type="button"
                  class="list-group-item list-group-item-action py-3 px-4 border-0 d-flex align-items-center"
                  [class.active]="activeTab === 'orders'"
                  (click)="changeTab('orders')">
            <i class="bi bi-box-seam me-3 fs-5"></i>
            My Orders
          </button>
          <button type="button"
                  class="list-group-item list-group-item-action py-3 px-4 border-0 d-flex align-items-center"
                  [class.active]="activeTab === 'details'"
                  (click)="changeTab('details')">
            <i class="bi bi-person me-3 fs-5"></i>
            Account Details
          </button>
          <button type="button"
                  class="list-group-item list-group-item-action py-3 px-4 border-0 d-flex align-items-center"
                  [class.active]="activeTab === 'password'"
                  (click)="changeTab('password')">
            <i class="bi bi-lock me-3 fs-5"></i>
            Change Password
          </button>
          <button type="button"
                  class="list-group-item list-group-item-action py-3 px-4 border-0 d-flex align-items-center text-danger"
                  (click)="logout()">
            <i class="bi bi-box-arrow-right me-3 fs-5"></i>
            Logout
          </button>
        </div>
      </div>
    </div>

    <!-- Right Content Area -->
    <div class="col-lg-9">
      <div class="card border-0 shadow-sm rounded-4 p-4 min-vh-50">

        <!-- Orders Tab -->
        <div *ngIf="activeTab === 'orders'">
          <h4 class="fw-bold mb-4">Order History</h4>

          <div *ngIf="orders.length === 0" class="text-center py-5">
            <i class="bi bi-cart-x display-1 text-muted mb-3"></i>
            <p class="lead text-muted">No orders found yet.</p>
            <a routerLink="/shop/products" class="btn btn-success mt-2">Start Shopping</a>
          </div>

          <div class="d-flex flex-column gap-3">
            <div *ngFor="let order of orders" class="card border rounded-3 p-3 hover-shadow transition-all">
              <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">

                <div class="d-flex flex-column">
                  <span class="fw-bold text-dark fs-5">{{ order.id }}</span>
                  <span class="text-muted small">{{ order.date | date:'mediumDate' }}</span>
                </div>

                <div class="d-flex flex-column">
                  <span class="text-muted small">Total</span>
                  <span class="fw-bold text-success">{{ order.totalAmount | currency }}</span>
                </div>

                <div class="d-flex flex-column">
                  <span class="text-muted small">Items</span>
                  <span class="fw-semibold">{{ order.itemCount }} items</span>
                </div>

                <div class="d-flex flex-column">
                  <span class="text-muted small">Status</span>
                  <span class="badge rounded-pill" [ngClass]="getStatusClass(order.status)">
                    {{ order.status }}
                  </span>
                </div>

                <div>
                  <button class="btn btn-outline-secondary btn-sm rounded-pill px-3">
                    View Details
                  </button>
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- Account Details Tab -->
        <div *ngIf="activeTab === 'details'">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="fw-bold mb-0">Profile Information</h4>
            <button class="btn btn-outline-primary btn-sm rounded-pill px-3" (click)="toggleEdit()">
              <i class="bi" [ngClass]="isEditing ? 'bi-x-lg' : 'bi-pencil-square'"></i>
              {{ isEditing ? 'Cancel' : 'Edit Profile' }}
            </button>
          </div>

          <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
          <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

          <ng-container *ngIf="currentUser$ | async as user">
            <!-- View Mode -->
            <div *ngIf="!isEditing" class="row g-4">
              <div class="col-12 d-flex align-items-center mb-3">
                <div class="position-relative me-4">
                  <img [src]="user.avatarUrl || 'assets/default-avatar.png'"
                       alt="Profile"
                       class="rounded-circle shadow-sm"
                       width="100" height="100"
                       style="object-fit: cover;">
                </div>
                <div>
                  <h5 class="fw-bold mb-1">{{ user.firstName }} {{ user.lastName }}</h5>
                  <p class="text-muted mb-0">{{ user.email }}</p>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label text-muted small text-uppercase fw-bold">First Name</label>
                <div class="p-3 bg-light rounded-3 border">
                  {{ user.firstName }}
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label text-muted small text-uppercase fw-bold">Last Name</label>
                <div class="p-3 bg-light rounded-3 border">
                  {{ user.lastName }}
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label text-muted small text-uppercase fw-bold">Email Address</label>
                <div class="p-3 bg-light rounded-3 border">
                  {{ user.email }}
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label text-muted small text-uppercase fw-bold">Phone Number</label>
                <div class="p-3 bg-light rounded-3 border">
                  {{ user.phone || 'Not provided' }}
                </div>
              </div>
            </div>

            <!-- Edit Mode -->
            <form *ngIf="isEditing" [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="firstName" class="form-label">First Name</label>
                  <input type="text" class="form-control" id="firstName" formControlName="firstName">
                </div>
                <div class="col-md-6">
                  <label for="lastName" class="form-label">Last Name</label>
                  <input type="text" class="form-control" id="lastName" formControlName="lastName">
                </div>
                <div class="col-md-6">
                  <label for="email" class="form-label">Email Address</label>
                  <input type="email" class="form-control" id="email" formControlName="email">
                </div>
                <div class="col-md-6">
                  <label for="phone" class="form-label">Phone Number</label>
                  <input type="tel" class="form-control" id="phone" formControlName="phone">
                </div>
                <div class="col-12 mt-4">
                  <button type="submit" class="btn btn-success px-4 rounded-pill" [disabled]="loading">
                    <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    Save Changes
                  </button>
                </div>
              </div>
            </form>
          </ng-container>
        </div>

        <!-- Change Password Tab -->
        <div *ngIf="activeTab === 'password'">
          <h4 class="fw-bold mb-4">Change Password</h4>

          <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
          <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

          <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()" class="row g-3" style="max-width: 500px;">
            <div class="col-12">
              <label for="currentPassword" class="form-label">Current Password</label>
              <input type="password" class="form-control" id="currentPassword" formControlName="currentPassword">
            </div>
            <div class="col-12">
              <label for="newPassword" class="form-label">New Password</label>
              <input type="password" class="form-control" id="newPassword" formControlName="newPassword">
            </div>
            <div class="col-12">
              <label for="confirmPassword" class="form-label">Confirm New Password</label>
              <input type="password" class="form-control" id="confirmPassword" formControlName="confirmPassword">
              <div *ngIf="passwordForm.errors?.mismatch && (passwordForm.touched || passwordForm.dirty)" class="text-danger small mt-1">
                Passwords do not match
              </div>
            </div>
            <div class="col-12 mt-4">
              <button type="submit" class="btn btn-success px-4 rounded-pill" [disabled]="loading || passwordForm.invalid">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                Update Password
              </button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>
</div>
